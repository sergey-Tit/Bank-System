Ниже - описание приложения банковской системы, написанного в 5 этапов, используя Java и фреймворк Spring boot

# Первый этап

Система сборки - Maven

## Сущности

- ### Юзер
  - имеет login, имя, возраст, пол, цвет волос (enum), список друзей
  - список друзей может меняться
- ### Счёт
  - имеет id, баланс, login пользователя-владельца, историю операций
  - баланс может меняться, каждое изменение баланса добавляет новый элемент в историю операций

## Функциональные требования

- создание юзера
- вывод информации о юзере
- изменение списков друзей юзеров
- создание счёта (у одного юзера может быть больше одного счёта)
- просмотр баланса счёта
- снятие денег со счёта
- пополнение счета
- перевод денег с одного счёта на другой
- за переводы между счетами снимается комиссия (между своими 0%, другу 3%, иначе 10%)

## Не функциональные требования

- При запуске сборки приложения автоматически генерируется документация JavaDoc
- Интерактивный консольный интерфейс
- Приложение представлено в трех модулях - по 3-х слойной архитектуре. На первом этапе DataAccess слой был написан реализован на in-memory репозиториях.

## Test cases

- снятие денег со счёта
    - при достаточном балансе проверяется что сохраняется счёт с корректно обновлённым балансом
    - при недостаточном балансе сервис должен вернуть ошибку
- пополнение счёта
    - провоеряется что сохраняется счёт с корректно обновлённым балансом

В данных тестах используются моки репозиториев, чтобы проверять именно бизнес логику

# Второй этап

Hibernate, JPA, JDBC

На этом этапе DataAccess слой был изменен с помощью Hibernate. С этого момента все данные хранятся в БД PostgreSQL, для связи с которой используется Hibernate.

# Третий этап

Spring Framework, Spring Boot, JpaRepository, REST API, Dependency Injection, Swagger

К созданному в прошлых лабораторных сервису добавляется использование Spring Framework, Spring Boot, внедрения зависимостей (Dependency Injection).

Слой Presentation переписывается на использование контроллеров. Контроллеры должны предоставлять HTTP эндпоинты (**REST API**) для получения информации о конкретных пользователях и их счетах и для взаимодействия с пользователями и их счетами. 

## Функциональные требования

- Все сценарии из предыдущих этапов реализованны через HTTP эндпоинты.
- Реализованы эндпоинты для получения аккаунтов по идентификатору пользователя, получение друзей по идентификатору пользователя, получение всех пользователей системы с фильтрацией по цвету волос и гендеру, получение всех аккаунтов, получение всех операций с фильтрацией по типу и идентификатору аккаунта.

## Нефункциональные требования

- Используется Dependency Injection
- Контроллеры отдают и принимают DTO
- Репозитории - Spring Bean'ы (наследуются от JpaRepository)
- Строгое соблюдение REST спецификации для эндпоинтов
- Все эндпоинты имеют описание возможных кодов в Swagger документации

# Четвертый этап

Spring Security

На этом этапе было разработано отдельное Spring Boot-приложение (`API Gateway`), которое:
 - Обрабатывает все входящие `HTTP-запросы`
 - Проверяет аутентификацию и права доступа
 - Перенаправляет запросы в основное приложение (реализованное в предыдущих этапах)

Существующий функционал банковской системы остаётся без изменений.

Появится роль `Admin`. Не является пользователем, то есть не может иметь счёта или друзей.
Появится роль `Client`. Пользователь, реализованный в прошлых лабораторных работах связан с ролью `Client` в отношении 1:1

## Функциональные требования
### `Admin`
- Создание пользователя
- Создание администратора
- Получение информации о всех пользователях с фильтрацией по гендеру и цвету волос 
- Получение информации о пользователе по его идентификатору
- Получение информации о всех счётах пользователей
- Получение информации о счетах по идентификатору пользователя
- Получение информации о счёте со списком его операций по идентификатору счёта

### `Client`
- Получение информации о себе
- Получение информации о своих счетах
- Получение информации о счёте по его идентификатору
- Добавление другого пользователя в друзья
- Удаление пользователя из друзей
- Перевод/Снятие/Пополнение счёта

### `Неавторизованный пользователь`
- Может авторизоваться

## Нефункциональные требования
- Закрытая регистрация пользователей - только администраторы могут создавать новых пользователей
- Неавторизованные пользователи не должны иметь доступ к любым эндпоинтам системы, кроме `/login`
- Любая попытка неавторизованного доступа должна возвращать `401 Unauthorized` или `403 Forbidden`
- Пользователь может получать и изменять только те данные, которые принадлежат ему
- Попытка доступа к чужим данным должна возвращать `403 Forbidden`
- Пароли пользователей должны храниться в зашифрованном виде
- Реализована базовая аутентификация

# Пятый этап

Асинхронное межсервисное взаимодействие, Kafka/RabbitMQ

Реализовано отдельное Spring Boot (Storage) приложение для хранения событий о создании и изменении сущностей пользователей и счетов. Bank-service отправляет события в соответствующие топики:  
- Для пользователей `client-topic`  
- Для счетов `account-topic`  

Ключом сообщения является идентификатор сущности (пользователя/счета), а значением - JSON с информацией об изменении.  

## Функциональные требования

- Bank-service публикует события в топики связанных сущностей
- Storage сохраняет события из топиков `client-topic` и `account-topic` в свою базу данных (в разных таблицах)
